<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Qushal Tours — E-Ticket</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{ --primary:#06b6d4; --secondary:#2563eb; --muted:#6b7280; }
    html,body{height:100%;margin:0;font-family:"Poppins",sans-serif;background:#f3f4f6;color:#111}
    .app{padding:28px;display:flex;justify-content:center}
    .card{width:900px;max-width:100%;background:#fff;border-radius:12px;box-shadow:0 12px 40px rgba(2,6,23,0.08);overflow:hidden}
    .hdr{padding:18px 20px;background:linear-gradient(90deg,var(--primary),var(--secondary));color:#fff;display:flex;justify-content:space-between;align-items:center}
    .body{padding:18px 20px}
    .logo{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;background:linear-gradient(135deg,var(--primary),var(--secondary))}
    .muted{color:var(--muted);font-size:0.85rem}
    #ticket-body::before{content:"QUSHAL TOURS";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) rotate(-18deg);font-size:4.5rem;color:rgba(0,0,0,0.02);pointer-events:none;user-select:none}
    @media print{
      .no-print{display:none!important}
      .app{padding:0}
      .card{box-shadow:none;border:1px solid #eee;border-radius:4px}
      body{font-size:11px}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card" id="ticket-body">
      <div class="hdr">
        <div style="display:flex;gap:12px;align-items:center">
          <div class="logo" aria-hidden="true">QT</div>
          <div>
            <div style="font-weight:700;font-size:1.05rem">Qushal Tours and Travels</div>
            <div class="muted" id="subtitle">Tour Booking — Ticket</div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,0.12);padding:6px 10px;border-radius:8px">
            <i data-lucide="clock" style="width:18px;height:18px;color:#fff"></i>
            <div id="status" style="font-weight:600;color:#fff">PENDING</div>
          </div>
          <div class="muted" id="booked-on" style="margin-top:6px;color:rgba(255,255,255,0.9)">—</div>
        </div>
      </div>

      <div class="body">
        <div style="margin-bottom:12px">
          <div id="greeting" style="font-weight:700;font-size:1.05rem;margin-bottom:6px">Hello, Guest!</div>

          <div style="display:flex;gap:10px;align-items:flex-start;padding:8px;background:#fff7e6;border:1px solid #fde3a7;border-radius:8px;margin-bottom:8px">
            <i data-lucide="star" style="width:20px;height:20px;color:#d97706"></i>
            <div style="font-weight:600">Thanks for booking. We will contact you to confirm availability and final price.</div>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:2fr 1fr;gap:16px;align-items:start">
          <div>
            <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px">
              <div>
                <div class="muted">Pickup (From)</div>
                <div id="from" style="font-weight:700;font-size:1.05rem">—</div>
              </div>
              <div>
                <div class="muted">Destination / Tour</div>
                <div id="to" style="font-weight:700;font-size:1.05rem">—</div>
              </div>

              <div>
                <div class="muted">Pickup Date</div>
                <div id="date" style="font-weight:600">—</div>
              </div>
              <div>
                <div class="muted">Pickup Time</div>
                <div id="time" style="font-weight:600">—</div>
              </div>

              <div>
                <div class="muted">Passengers</div>
                <div id="passengers" style="font-weight:600">—</div>
              </div>
              <div>
                <div class="muted">Return Date</div>
                <div id="returndate" style="font-weight:600">—</div>
              </div>
            </div>

            <div style="margin-top:12px">
              <div class="muted">Pickup Address</div>
              <div id="address" style="font-weight:600">—</div>
            </div>

            <div style="margin-top:10px">
              <div class="muted">Special Instructions</div>
              <div id="notes" style="font-weight:600">—</div>
            </div>

            <div style="margin-top:12px;display:grid;grid-template-columns:repeat(2,1fr);gap:10px">
              <div>
                <div class="muted">Hotel Preference</div>
                <div id="hotel" style="font-weight:600">—</div>
              </div>
              <div>
                <div class="muted">Vehicle Preference</div>
                <div id="vehicle" style="font-weight:600">—</div>
              </div>
              <div>
                <div class="muted">Payment Method</div>
                <div id="payment" style="font-weight:600">—</div>
              </div>
              <div>
                <div class="muted">Promo Code</div>
                <div id="promo" style="font-weight:600">—</div>
              </div>
              <div style="grid-column:1 / -1">
                <div class="muted">GST / VAT</div>
                <div id="gst" style="font-weight:600">—</div>
              </div>
            </div>
          </div>

          <div style="text-align:center">
            <div style="display:inline-block;padding:12px;border-radius:14px;background:linear-gradient(180deg,#fff,#f7f9fb);box-shadow:0 8px 20px rgba(2,6,23,0.06);">
              <div style="background:#fff;padding:10px;border-radius:10px;display:inline-block;">
                <img id="qrImg" src="" alt="QR code" width="200" height="200" style="display:block;border-radius:8px;box-shadow:0 8px 24px rgba(2,6,23,0.08)"/>
              </div>
              <div class="muted" style="margin-top:8px">Scan to verify</div>
              <div style="margin-top:8px">
                <a id="downloadQr" href="#" download="" class="muted" style="text-decoration:none;border:1px solid #e6eef6;padding:6px 8px;border-radius:8px;background:#f8fbff;color:#0b69c6">Download QR</a>
              </div>
            </div>

            <div style="margin-top:10px" class="muted">Booking ID</div>
            <div id="bid" style="font-weight:700;font-size:1.05rem;margin-top:6px">QT-XXXXX</div>

            <div style="margin-top:12px" class="muted">Contact</div>
            <div id="company" style="font-weight:600;margin-top:4px">+91 98765 43210</div>
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:18px">
          <div>
            <div style="font-weight:700;color:var(--primary);margin-bottom:8px">Passenger / Booker</div>
            <div class="muted">Name</div>
            <div id="bname" style="font-weight:600">—</div>
            <div class="muted" style="margin-top:8px">Phone</div>
            <div id="bphone" style="font-weight:600">—</div>
            <div class="muted" style="margin-top:8px">Email</div>
            <div id="bemail" style="font-weight:600">—</div>
            <div class="muted" style="margin-top:8px">Alternate phone</div>
            <div id="balt" style="font-weight:600">—</div>
          </div>

          <div>
            <div style="font-weight:700;color:var(--primary);margin-bottom:8px">Estimate (Reference)</div>
            <div class="muted">Base fare</div>
            <div id="est-base" style="font-weight:600">—</div>
            <div class="muted" style="margin-top:8px">Taxes / Tolls</div>
            <div id="est-taxes" style="font-weight:600">—</div>
            <div class="muted" style="margin-top:8px">Total estimate</div>
            <div id="est-total" style="font-weight:700;color:var(--primary)">—</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div style="text-align:center;margin:14px 0" class="no-print">
    <button onclick="window.print()" style="padding:10px 14px;background:#374151;color:#fff;border-radius:8px;border:none;margin-right:8px;cursor:pointer">Download / Print</button>
    <a id="back" href="tours_book.html" style="padding:10px 14px;background:var(--primary);color:#fff;border-radius:8px;text-decoration:none">Back to Booking</a>
  </div>

  <script>
    (function(){
      function createIcons(){ if(window.lucide && typeof lucide.createIcons==='function'){ try{ lucide.createIcons(); }catch(e){} } }
      function setText(id,v){ const el=document.getElementById(id); if(!el) return; el.textContent = v==null ? '' : String(v); }
      function fmtDate(d){ try{ if(!d) return '—'; const D=new Date(d); if(isNaN(D)) return d; return D.toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'}); }catch(e){ return d; } }
      function fmtTime(t){ try{ if(!t) return '—'; const parts=(t||'').split(':'); if(parts.length<2) return t; let hh=parseInt(parts[0],10); let mm=parts[1].padStart(2,'0').slice(0,2); if(isNaN(hh)) return t; const am = hh>=12 ? 'PM':'AM'; const sh = (hh%12)||12; return sh + ':' + mm + ' ' + am; }catch(e){return t;} }
      function mapVehicle(v){ if(!v) return '—'; const m={sedan:'Sedan (4 seater)', suv:'SUV (6-7 seater)', 'tempo-traveller':'Tempo Traveller (12-15)', minibus:'Mini Bus (20-30)', luxury:'Luxury'}; return m[(v||'').toLowerCase()]||v; }
      function mapHotel(v){ if(!v) return '—'; const m={budget:'Budget', standard:'Standard', deluxe:'Deluxe'}; return m[(v||'').toLowerCase()]||v; }
      function mapPayment(v){ if(!v) return '—'; const m={'pay-later':'Pay at office', upi:'UPI', card:'Card', netbanking:'Netbanking'}; return m[(v||'').toLowerCase()]||v; }

      const params = new URLSearchParams(window.location.search);

      // known tour slugs -> display
      const tours = { jaipur:'Jaipur', goa:'Goa', manali:'Manali', kashmir:'Kashmir', rajasthan:'Rajasthan', kerala:'Kerala' };
      const tourRaw = params.get('tour-name') || params.get('tour') || params.get('t') || '';
      const tourSlug = tourRaw ? decodeURIComponent(tourRaw).toLowerCase() : '';
      const tourDisplay = tourRaw ? decodeURIComponent(tourRaw) : (tourSlug && tours[tourSlug] ? tours[tourSlug] : '');

      // set ticket fields
      setText('from', params.get('pickup-location') || '—');
      // to: prefer drop-location, else tour display
      setText('to', params.get('drop-location') || tourDisplay || '—');

      setText('date', fmtDate(params.get('pickup-date')));
      setText('time', fmtTime(params.get('pickup-time')));
      setText('passengers', params.get('passengers') || '1');
      setText('returndate', fmtDate(params.get('return-date')));
      setText('address', params.get('pickup-address') || '—');
      setText('notes', params.get('instructions') || '—');

      setText('hotel', mapHotel(params.get('hotel-preference') || ''));
      setText('vehicle', mapVehicle(params.get('vehicle-preference') || params.get('vehicle-type') || ''));
      setText('payment', mapPayment(params.get('payment-method') || ''));
      setText('promo', params.get('promo-code') || '—');
      setText('gst', params.get('gst-number') || '—');

      const fullname = params.get('full-name') || params.get('name') || '';
      setText('greeting', 'Hello, ' + (fullname || 'Guest') + '!');
      setText('bname', fullname || '—');
      setText('bphone', params.get('phone') || '—');
      setText('bemail', params.get('email') || '—');
      setText('balt', params.get('alt-phone') || '—');

      setText('est-base', params.get('estimate-base') || '—');
      setText('est-taxes', params.get('estimate-taxes') || '—');
      setText('est-total', params.get('estimate-total') || '—');

      // booking id & timestamps
      const bookingId = 'QT-' + Math.random().toString(36).substring(2,8).toUpperCase();
      setText('bid', bookingId);
      setText('booked-on', new Date().toLocaleString('en-IN',{day:'numeric',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit'}));

      // Generate QR (uses api.qrserver.com). payload kept compact JSON.
      try {
        const qrImgEl = document.getElementById('qrImg');
        const downloadLink = document.getElementById('downloadQr');
        if (qrImgEl) {
          const payload = {
            bookingId: bookingId,
            name: fullname || params.get('full-name') || '',
            phone: params.get('phone') || '',
            tour: tourDisplay || params.get('drop-location') || params.get('tour') || '',
            pickup: params.get('pickup-location') || '',
            date: params.get('pickup-date') || '',
            time: params.get('pickup-time') || ''
          };
          const qrData = JSON.stringify(payload);
          const size = 400;
          const qrSrc = 'https://api.qrserver.com/v1/create-qr-code/?size=' + size + 'x' + size + '&format=png&data=' + encodeURIComponent(qrData) + '&qzone=2';
          qrImgEl.src = qrSrc;
          if (downloadLink) {
            downloadLink.href = qrSrc;
            downloadLink.setAttribute('download', (bookingId || 'QT') + '-qr.png');
            // improve accessibility
            downloadLink.setAttribute('aria-label', 'Download QR code image for ' + (bookingId || 'booking'));
          }
        }
      } catch (e) {
        // silent fallback
      }

      // subtitle / status adjustments
      setText('subtitle', tourDisplay ? 'Tour booking summary' : 'Pickup & Drop booking');
      setText('status', params.get('status') || 'PENDING');

      // back link: return to booking form with tour if available
      const back = document.getElementById('back');
      if(back){
        let href = 'tours_book.html';
        if(tourSlug) href += '?tour=' + encodeURIComponent(tourSlug);
        back.href = href;
      }

      createIcons();
      window.addEventListener('load', createIcons);
    })();
  </script>
</body>
</html>